<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Schema ERD</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            padding: 20px;
            min-height: 100vh;
            overflow-x: auto;
        }
        .header {
            background: white;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        h1 {
            color: #2c3e50;
            font-size: 28px;
            margin-bottom: 8px;
        }
        .subtitle {
            color: #7f8c8d;
            font-size: 14px;
        }
        .diagram-container {
            background: white;
            border-radius: 8px;
            padding: 40px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            position: relative;
            min-width: 1600px;
        }
        svg {
            width: 100%;
            height: auto;
        }
        .table-group {
            cursor: move;
        }
        .table-box {
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }
        .table-box:hover {
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
        }
        .table-header {
            font-weight: 600;
            font-size: 14px;
        }
        .column-text {
            font-size: 11px;
        }
        .pk-icon {
            fill: #e74c3c;
        }
        .fk-icon {
            fill: #3498db;
        }
        .relation-line {
            stroke: #3498db;
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead);
        }
        .relation-line-missing {
            stroke: #e74c3c;
            stroke-width: 2;
            stroke-dasharray: 5,5;
            fill: none;
            marker-end: url(#arrowhead-missing);
        }
        .schema-label {
            font-size: 16px;
            font-weight: bold;
            fill: #34495e;
        }
        .legend {
            position: absolute;
            top: 40px;
            right: 40px;
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            font-size: 12px;
        }
        .legend-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            color: #495057;
        }
        .legend-line {
            width: 30px;
            height: 2px;
            margin-right: 10px;
        }
        .legend-line-solid {
            background: #3498db;
        }
        .legend-line-dashed {
            background: repeating-linear-gradient(
                to right,
                #e74c3c 0,
                #e74c3c 5px,
                transparent 5px,
                transparent 10px
            );
        }
        .notes {
            margin-top: 20px;
            padding: 20px;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            border-radius: 4px;
        }
        .notes h3 {
            color: #856404;
            margin-bottom: 10px;
        }
        .notes ul {
            margin-left: 20px;
            color: #856404;
        }
        .notes li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
<div class="header">
    <h1>üìä Oficjalny Schemat Bazy Danych</h1>
    <div class="subtitle">Food & Workout Management System | PostgreSQL 16.3</div>
</div>

<div class="diagram-container">
    <div class="legend">
        <div class="legend-title">Legenda</div>
        <div class="legend-item">
            <svg width="20" height="20"><circle cx="10" cy="10" r="4" fill="#e74c3c"/></svg>
            <span style="margin-left: 5px;">Primary Key</span>
        </div>
        <div class="legend-item">
            <svg width="20" height="20"><circle cx="10" cy="10" r="4" fill="#3498db"/></svg>
            <span style="margin-left: 5px;">Foreign Key</span>
        </div>
        <div class="legend-item">
            <div class="legend-line legend-line-solid"></div>
            <span>Relacja (FK exists)</span>
        </div>
        <div class="legend-item">
            <div class="legend-line legend-line-dashed"></div>
            <span>Relacja brakujƒÖca</span>
        </div>
    </div>

    <svg viewBox="0 0 1600 1400" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                <polygon points="0 0, 10 3, 0 6" fill="#3498db"/>
            </marker>
            <marker id="arrowhead-missing" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                <polygon points="0 0, 10 3, 0 6" fill="#e74c3c"/>
            </marker>
        </defs>

        <!-- Schema Labels -->
        <text x="50" y="30" class="schema-label">SCHEMA: users</text>
        <text x="50" y="430" class="schema-label">SCHEMA: public (Diet Management)</text>
        <text x="900" y="430" class="schema-label">SCHEMA: workout</text>

        <!-- USERS SCHEMA -->
        <!-- users table -->
        <g class="table-group" id="users-table">
            <rect x="50" y="50" width="280" height="320" fill="white" stroke="#dee2e6" stroke-width="2" rx="8"/>
            <rect x="50" y="50" width="280" height="40" fill="#667eea" rx="8 8 0 0"/>
            <text x="190" y="75" text-anchor="middle" fill="white" class="table-header">users.users</text>

            <circle cx="70" cy="105" r="4" class="pk-icon"/>
            <text x="80" y="110" class="column-text">id: integer</text>

            <text x="80" y="130" class="column-text">username: varchar(20) UNIQUE</text>
            <text x="80" y="150" class="column-text">email: varchar(50) UNIQUE</text>
            <text x="80" y="170" class="column-text">password: varchar(120)</text>
            <text x="80" y="190" class="column-text">name: varchar(50)</text>
            <text x="80" y="210" class="column-text">surname: varchar(50)</text>
            <text x="80" y="230" class="column-text">is_active: boolean</text>
            <text x="80" y="250" class="column-text">email_verified: boolean</text>
            <text x="80" y="270" class="column-text">email_verification_token: varchar(255)</text>
            <text x="80" y="290" class="column-text">email_verification_expires: timestamp</text>
            <text x="80" y="310" class="column-text">last_login: timestamp</text>
        </g>

        <!-- roles table -->
        <g class="table-group" id="roles-table">
            <rect x="400" y="50" width="200" height="100" fill="white" stroke="#dee2e6" stroke-width="2" rx="8"/>
            <rect x="400" y="50" width="200" height="40" fill="#667eea" rx="8 8 0 0"/>
            <text x="500" y="75" text-anchor="middle" fill="white" class="table-header">users.roles</text>

            <circle cx="420" cy="105" r="4" class="pk-icon"/>
            <text x="430" y="110" class="column-text">id: integer</text>
            <text x="430" y="130" class="column-text">name: varchar(20)</text>
        </g>

        <!-- user_roles table -->
        <g class="table-group" id="user-roles-table">
            <rect x="400" y="200" width="200" height="100" fill="white" stroke="#dee2e6" stroke-width="2" rx="8"/>
            <rect x="400" y="200" width="200" height="40" fill="#667eea" rx="8 8 0 0"/>
            <text x="500" y="225" text-anchor="middle" fill="white" class="table-header">users.user_roles</text>

            <circle cx="420" cy="255" r="4" class="pk-icon"/>
            <circle cx="433" cy="255" r="4" class="fk-icon"/>
            <text x="443" y="260" class="column-text">user_id: bigint</text>

            <circle cx="420" cy="275" r="4" class="pk-icon"/>
            <circle cx="433" cy="275" r="4" class="fk-icon"/>
            <text x="443" y="280" class="column-text">role_id: bigint</text>
        </g>

        <!-- DIET SCHEMA -->
        <!-- diet_summary table -->
        <g class="table-group" id="diet-summary-table">
            <rect x="50" y="470" width="280" height="220" fill="white" stroke="#dee2e6" stroke-width="2" rx="8"/>
            <rect x="50" y="470" width="280" height="40" fill="#2ecc71" rx="8 8 0 0"/>
            <text x="190" y="495" text-anchor="middle" fill="white" class="table-header">public.diet_summary</text>

            <circle cx="70" cy="525" r="4" class="pk-icon"/>
            <text x="80" y="530" class="column-text">id: integer</text>

            <circle cx="70" cy="545" r="4" class="fk-icon"/>
            <text x="80" y="550" class="column-text">user_id: bigint (FK missing!)</text>

            <text x="80" y="570" class="column-text">date: date</text>
            <text x="80" y="590" class="column-text">kcal: double precision</text>
            <text x="80" y="610" class="column-text">protein: double precision</text>
            <text x="80" y="630" class="column-text">carbohydrates: double precision</text>
            <text x="80" y="650" class="column-text">fat: double precision</text>
            <text x="80" y="670" class="column-text">meals: jsonb</text>
        </g>

        <!-- meal_recipe table -->
        <g class="table-group" id="meal-recipe-table">
            <rect x="50" y="730" width="280" height="280" fill="white" stroke="#dee2e6" stroke-width="2" rx="8"/>
            <rect x="50" y="730" width="280" height="40" fill="#2ecc71" rx="8 8 0 0"/>
            <text x="190" y="755" text-anchor="middle" fill="white" class="table-header">public.meal_recipe</text>

            <circle cx="70" cy="785" r="4" class="pk-icon"/>
            <text x="80" y="790" class="column-text">id: integer</text>
            <text x="80" y="810" class="column-text">name: text</text>
            <text x="80" y="830" class="column-text">kcal: double precision</text>
            <text x="80" y="850" class="column-text">protein: double precision</text>
            <text x="80" y="870" class="column-text">carbohydrates: double precision</text>
            <text x="80" y="890" class="column-text">fat: double precision</text>
            <text x="80" y="910" class="column-text">portion_amount: double precision</text>
            <text x="80" y="930" class="column-text">url: text</text>
            <text x="80" y="950" class="column-text">category: text</text>
            <text x="80" y="970" class="column-text">type: text</text>
            <text x="80" y="990" class="column-text">recipe: jsonb</text>
        </g>

        <!-- meal_ingredient table -->
        <g class="table-group" id="meal-ingredient-table">
            <rect x="380" y="730" width="260" height="180" fill="white" stroke="#dee2e6" stroke-width="2" rx="8"/>
            <rect x="380" y="730" width="260" height="40" fill="#2ecc71" rx="8 8 0 0"/>
            <text x="510" y="755" text-anchor="middle" fill="white" class="table-header">public.meal_ingredient</text>

            <circle cx="400" cy="785" r="4" class="pk-icon"/>
            <text x="410" y="790" class="column-text">id: integer</text>

            <circle cx="400" cy="805" r="4" class="fk-icon"/>
            <text x="410" y="810" class="column-text">meal_id: integer</text>

            <circle cx="400" cy="825" r="4" class="fk-icon"/>
            <text x="410" y="830" class="column-text">product_id: integer</text>

            <text x="410" y="850" class="column-text">name: text</text>
            <text x="410" y="870" class="column-text">amount: double precision</text>
            <text x="410" y="890" class="column-text">unit: text</text>
        </g>

        <!-- product table -->
        <g class="table-group" id="product-table">
            <rect x="380" y="950" width="260" height="220" fill="white" stroke="#dee2e6" stroke-width="2" rx="8"/>
            <rect x="380" y="950" width="260" height="40" fill="#2ecc71" rx="8 8 0 0"/>
            <text x="510" y="975" text-anchor="middle" fill="white" class="table-header">public.product</text>

            <circle cx="400" cy="1005" r="4" class="pk-icon"/>
            <text x="410" y="1010" class="column-text">id: integer</text>
            <text x="410" y="1030" class="column-text">name: text</text>
            <text x="410" y="1050" class="column-text">kcal: double precision</text>
            <text x="410" y="1070" class="column-text">protein: double precision</text>
            <text x="410" y="1090" class="column-text">carbohydrates: double precision</text>
            <text x="410" y="1110" class="column-text">fat: double precision</text>
            <text x="410" y="1130" class="column-text">amount: double precision</text>
            <text x="410" y="1150" class="column-text">unit: text</text>
        </g>

        <!-- WORKOUT SCHEMA -->
        <!-- training table -->
        <g class="table-group" id="training-table">
            <rect x="900" y="470" width="280" height="180" fill="white" stroke="#dee2e6" stroke-width="2" rx="8"/>
            <rect x="900" y="470" width="280" height="40" fill="#e67e22" rx="8 8 0 0"/>
            <text x="1040" y="495" text-anchor="middle" fill="white" class="table-header">workout.training</text>

            <circle cx="920" cy="525" r="4" class="pk-icon"/>
            <text x="930" y="530" class="column-text">id: integer (identity)</text>

            <circle cx="920" cy="545" r="4" class="fk-icon"/>
            <text x="930" y="550" class="column-text">user_id: bigint (FK missing!)</text>

            <text x="930" y="570" class="column-text">name: varchar(255)</text>
            <text x="930" y="590" class="column-text">date: date</text>
            <text x="930" y="610" class="column-text">place: varchar(255)</text>
            <text x="930" y="630" class="column-text">created_at: timestamp</text>
        </g>

        <!-- exercise table -->
        <g class="table-group" id="exercise-table">
            <rect x="900" y="690" width="280" height="160" fill="white" stroke="#dee2e6" stroke-width="2" rx="8"/>
            <rect x="900" y="690" width="280" height="40" fill="#e67e22" rx="8 8 0 0"/>
            <text x="1040" y="715" text-anchor="middle" fill="white" class="table-header">workout.exercise</text>

            <circle cx="920" cy="745" r="4" class="pk-icon"/>
            <text x="930" y="750" class="column-text">id: integer (identity)</text>

            <circle cx="920" cy="765" r="4" class="fk-icon"/>
            <text x="930" y="770" class="column-text">training_id: bigint</text>

            <text x="930" y="790" class="column-text">name: varchar(255)</text>
            <text x="930" y="810" class="column-text">type: varchar(255)</text>
            <text x="930" y="830" class="column-text">progress: varchar(255)</text>
        </g>

        <!-- exercise_set table -->
        <g class="table-group" id="exercise-set-table">
            <rect x="900" y="890" width="280" height="120" fill="white" stroke="#dee2e6" stroke-width="2" rx="8"/>
            <rect x="900" y="890" width="280" height="40" fill="#e67e22" rx="8 8 0 0"/>
            <text x="1040" y="915" text-anchor="middle" fill="white" class="table-header">workout.exercise_set</text>

            <circle cx="920" cy="945" r="4" class="pk-icon"/>
            <text x="930" y="950" class="column-text">id: integer (identity)</text>

            <circle cx="920" cy="965" r="4" class="fk-icon"/>
            <text x="930" y="970" class="column-text">exercise_id: bigint</text>

            <text x="930" y="990" class="column-text">rep: double precision</text>
        </g>

        <!-- training_template table -->
        <g class="table-group" id="training-template-table">
            <rect x="1230" y="470" width="300" height="100" fill="white" stroke="#dee2e6" stroke-width="2" rx="8"/>
            <rect x="1230" y="470" width="300" height="40" fill="#e67e22" rx="8 8 0 0"/>
            <text x="1380" y="495" text-anchor="middle" fill="white" class="table-header">workout.training_template</text>

            <circle cx="1250" cy="525" r="4" class="pk-icon"/>
            <text x="1260" y="530" class="column-text">id: integer</text>
            <text x="1260" y="550" class="column-text">name: varchar(255) UNIQUE</text>
        </g>

        <!-- exercise_name table -->
        <g class="table-group" id="exercise-name-table">
            <rect x="1230" y="610" width="300" height="100" fill="white" stroke="#dee2e6" stroke-width="2" rx="8"/>
            <rect x="1230" y="610" width="300" height="40" fill="#e67e22" rx="8 8 0 0"/>
            <text x="1380" y="635" text-anchor="middle" fill="white" class="table-header">workout.exercise_name</text>

            <circle cx="1250" cy="665" r="4" class="pk-icon"/>
            <text x="1260" y="670" class="column-text">id: integer</text>
            <text x="1260" y="690" class="column-text">name: varchar(255) UNIQUE</text>
        </g>

        <!-- training_template_exercise table -->
        <g class="table-group" id="training-template-exercise-table">
            <rect x="1230" y="750" width="300" height="120" fill="white" stroke="#dee2e6" stroke-width="2" rx="8"/>
            <rect x="1230" y="750" width="300" height="40" fill="#e67e22" rx="8 8 0 0"/>
            <text x="1380" y="775" text-anchor="middle" fill="white" class="table-header">workout.training_template_exercise</text>

            <circle cx="1250" cy="805" r="4" class="pk-icon"/>
            <text x="1260" y="810" class="column-text">id: integer</text>

            <circle cx="1250" cy="825" r="4" class="fk-icon"/>
            <text x="1260" y="830" class="column-text">training_template_id: bigint</text>

            <circle cx="1250" cy="845" r="4" class="fk-icon"/>
            <text x="1260" y="850" class="column-text">exercise_name_id: bigint</text>
        </g>

        <!-- RELATIONSHIPS -->
        <!-- user_roles -> users -->
        <path d="M 330 180 L 360 180 L 360 210 L 400 210" class="relation-line"/>

        <!-- user_roles -> roles -->
        <path d="M 500 200 L 500 150" class="relation-line"/>

        <!-- diet_summary -> users (MISSING FK) -->
        <path d="M 50 545 L 30 545 L 30 210 L 50 210" class="relation-line-missing"/>

        <!-- meal_ingredient -> meal_recipe -->
        <path d="M 380 820 L 330 820" class="relation-line"/>

        <!-- meal_ingredient -> product -->
        <path d="M 510 910 L 510 950" class="relation-line"/>

        <!-- training -> users (MISSING FK) -->
        <path d="M 900 545 L 700 545 L 700 210 L 330 210" class="relation-line-missing"/>

        <!-- exercise -> training -->
        <path d="M 1040 690 L 1040 650" class="relation-line"/>

        <!-- exercise_set -> exercise -->
        <path d="M 1040 890 L 1040 850" class="relation-line"/>

        <!-- training_template_exercise -> training_template -->
        <path d="M 1380 750 L 1380 570" class="relation-line"/>

        <!-- training_template_exercise -> exercise_name -->
        <path d="M 1380 750 L 1380 710" class="relation-line"/>
    </svg>

    <div class="notes">
        <h3>‚ö†Ô∏è Uwagi do schematu:</h3>
        <ul>
            <li><strong>CRITICAL:</strong> BrakujƒÖce klucze obce: <code>diet_summary.user_id</code> i <code>workout.training.user_id</code> ‚Üí <code>users.users(id)</code></li>
            <li>Niesp√≥jno≈õƒá typ√≥w: <code>users.roles.id</code> (integer) vs <code>user_roles.role_id</code> (bigint)</li>
            <li>Zalecane: Dodaƒá <code>UNIQUE</code> constraints na <code>users.email</code> i <code>users.username</code></li>
            <li>Dobra praktyka: Wszystkie tabele powinny mieƒá <code>created_at</code> i <code>updated_at</code></li>
            <li>JSONB: Pola <code>meals</code> i <code>recipe</code> wymagajƒÖ odpowiedniej walidacji w aplikacji</li>
        </ul>
    </div>
</div>
</body>
</html>